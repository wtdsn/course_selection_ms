import{aM as D,R as G,f as S,e as H}from"./index-bffb2048.js";import{E as J,a as L,v as X}from"./el-table-column-c2b21d3a.js";import{E as K,a as Q,_ as Y,g as Z,b as ee}from"./course-425ccdd9.js";import"./el-input-0d87eec8.js";import"./el-select-6e05db69.js";import{d as te,D as i,I as ae,H as se,V as oe,o as E,W as ne,X as k,a9 as B,u as o,c as A,w as n,a as t,am as f,ae as le,ac as ce,J as ie,aq as re,ar as ue,ao as de}from"./_plugin-vue_export-helper-1f852bcb.js";import"./el-form-item-97387915.js";function pe(){return D({url:"/stu/get-selections",method:"GET"})}function _e(r){return D({url:"/stu/add-selection",method:"POST",data:{courseId:r}})}function fe(r){return D({url:"/stu/del-selection",method:"POST",data:{id:r}})}const me=r=>(re("data-v-e6132a8b"),r=r(),ue(),r),ge={class:"course_select_con"},he={class:"left_course"},ve={class:"riht_selection"},we=me(()=>k("span",{class:"my_selection_title"},"我的选课",-1)),be=te({__name:"stu-select",setup(r){const m=i([]),g=i(!0);async function h(){g.value=!0;let{code:e,data:a}=await pe();g.value=!1,e&&(m.value=a,P(),z())}const v=i(new Set);function P(){v.value.clear(),m.value.forEach(e=>{v.value.add(e.courseId)})}const I=i(0),w=12,u=i(1),l=ae({flags:[],courses:[]}),b=i(!1);async function y(){b.value=!0;let{code:e,data:a}=await Z({page:u.value,size:w});b.value=!1,e&&(I.value=a.total,l.courses=a.courses,l.flags.length=l.courses.length,z())}se(u,()=>{y()});const d=i(!1);async function R(){if(d.value)return;d.value=!0;let e=Date.now();await y(),S.success("刷新成功"),e=Date.now()-e,e<1e3?e=1e3-e:e=0,setTimeout(()=>{d.value=!1},e)}function z(){l.courses.length&&l.courses.forEach((e,a)=>{l.flags[a]=v.value.has(e.courseId)})}oe(()=>{h(),y()});const C=i(!1),x=i();function M(e){C.value=!0,x.value=e}function V(){C.value=!1}async function $(e){const{code:a,msg:s}=await _e(e);a===1&&(S.success(s),h())}async function q(e){const{code:a,msg:s}=await fe(e);a===1&&(S.success(s),h())}return(e,a)=>{const s=J,p=H,N=L,F=ee,O=G,U=K,W=Q,T=X;return E(),ne("div",ge,[k("section",he,[B((E(),A(N,{data:o(l).courses,border:"",fit:"",style:{width:"100%"}},{default:n(()=>[t(s,{prop:"name",label:"课程名称","min-width":"120"}),t(s,{prop:"teacherName",label:"任教教师","min-width":"90"}),t(s,{prop:"place",label:"教学地点","min-width":"100"}),t(s,{prop:"time",label:"教学时间","min-width":"120"}),t(s,{prop:"curNum",label:"已选人数","min-width":"100"}),t(s,{prop:"stuNum",label:"可选人数","min-width":"100"}),t(s,{fixed:"right",label:"操作","min-width":"160"},{default:n(({$index:c,row:_})=>[t(p,{type:"success",size:"small",onClick:j=>M(_)},{default:n(()=>[f("详情")]),_:2},1032,["onClick"]),t(p,{type:"primary",size:"small",disabled:o(l).flags[c],onClick:j=>$(_.courseId)},{default:n(()=>[f(le(o(l).flags[c]?"已选":"选课"),1)]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[T,o(b)]]),t(U,{class:"pagination","current-page":o(u),"onUpdate:current-page":a[0]||(a[0]=c=>ie(u)?u.value=c:null),"page-size":w,"onUpdate:page-size":a[1]||(a[1]=c=>w=c),layout:"total,prev, pager, next, jumper,slot",background:!0,total:o(I)},{default:n(()=>[t(O,{class:ce(["refresh",{refreshing:o(d)}]),onClick:R},{default:n(()=>[t(F)]),_:1},8,["class"])]),_:1},8,["current-page","total"])]),k("section",ve,[we,B((E(),A(N,{data:o(m),border:"",fit:"",style:{width:"100%"}},{default:n(()=>[t(s,{prop:"name",label:"课程名称","min-width":"100"}),t(s,{prop:"teacherName",label:"任教教师","min-width":"90"}),t(s,{label:"操作","min-width":"160"},{default:n(({row:c})=>[t(p,{type:"success",size:"small",onClick:_=>M(c)},{default:n(()=>[f("详情")]),_:2},1032,["onClick"]),t(W,{title:"确定取消?",onConfirm:_=>q(c.id)},{reference:n(()=>[t(p,{type:"info",size:"small"},{default:n(()=>[f("取消选课")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[T,o(g)]])]),t(Y,{title:"课程详情",onCloseDetail:V,"is-show":o(C),course:o(x)},null,8,["is-show","course"])])}}});const ze=de(be,[["__scopeId","data-v-e6132a8b"]]);export{ze as default};
